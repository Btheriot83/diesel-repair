---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection, getEntryBySlug } from "astro:content";
import { buildInternalLinks } from "@/utils/linkBuilder";

export async function getStaticPaths() {
  const entries = await getCollection("corridors");
  return entries.map((e) => ({ params: { slug: e.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("corridors", slug);
if (!entry) throw new Error(`Corridor not found: ${slug}`);
const rendered = await entry.render();
const { Content } = rendered;
const data = entry.data;
const links = buildInternalLinks(data);
---
<BaseLayout
  title={data.title}
  metaTitle={data.metaTitle}
  metaDescription={data.metaDescription}
  canonical={data.canonical}
  pageType={data.pageType}
  faqs={data.faqs}
  breadcrumbs={data.breadcrumbs}
>
  <article class="prose max-w-none">
    <Content />

    <!-- Emergency CTA Section -->
    <div class="my-8 p-6 bg-red-50 border border-red-200 rounded-lg">
      <h2 class="text-xl font-bold text-red-800 mb-4">Need Emergency Service?</h2>
      <a
        href={links.emergencyLink.href}
        class="inline-block px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors"
      >
        {links.emergencyLink.text}
      </a>
    </div>

    <!-- Related Links Sections -->
    {links.corridorLinks.length > 0 && (
      <div class="my-8">
        <h3 class="text-lg font-semibold mb-4">Related Corridors</h3>
        <ul class="list-disc list-inside space-y-2">
          {links.corridorLinks.map((link) => (
            <li>
              <a href={link.href} class="text-blue-600 hover:text-blue-800 underline">
                {link.text}
              </a>
            </li>
          ))}
        </ul>
      </div>
    )}

    {links.cityLinks.length > 0 && (
      <div class="my-8">
        <h3 class="text-lg font-semibold mb-4">Cities Served</h3>
        <ul class="list-disc list-inside space-y-2">
          {links.cityLinks.map((link) => (
            <li>
              <a href={link.href} class="text-blue-600 hover:text-blue-800 underline">
                {link.text}
              </a>
            </li>
          ))}
        </ul>
      </div>
    )}

    {links.serviceLinks.length > 0 && (
      <div class="my-8">
        <h3 class="text-lg font-semibold mb-4">Available Services</h3>
        <ul class="list-disc list-inside space-y-2">
          {links.serviceLinks.map((link) => (
            <li>
              <a href={link.href} class="text-blue-600 hover:text-blue-800 underline">
                {link.text}
              </a>
            </li>
          ))}
        </ul>
      </div>
    )}
  </article>
</BaseLayout>
